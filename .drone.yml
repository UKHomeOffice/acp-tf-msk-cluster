---
kind: pipeline
name: default
type: kubernetes

platform:
  os: linux
  arch: amd64

steps:
- name: validate
  pull: if-not-exists
  image: quay.io/ukhomeofficedigital/terraform-toolset:v1.1.7
  commands:
  - 'echo "=== DEBUG: Full diff between current and generated ==="'
  - 'cp README.md README.md.backup'
  - 'terraform-docs md --output-file README.md . || true'
  - 'echo "--- Current (backed up)"'
  - 'echo "+++ Generated (new)"'
  - 'diff -u README.md.backup README.md || echo "Diff shown above"'
  - 'echo "=== DEBUG: Line count comparison ==="'
  - 'wc -l README.md.backup README.md'
  - 'echo "=== Now running actual validation ==="'
  - '/acp/scripts/tf-validate.sh'
  when:
    event:
    - pull_request
    - push

...
